openapi: 3.0.0
info:
  title: HewKawJang API
  version: 1.0.0
  description: API documentation for the HewKawJang Restaurant Reservation system
servers:
  - url: http://localhost:8080
components:
  schemas:
    Admin:
      type: object
      properties:
        id:
          type: integer
          example: 1
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        email:
          type: string
          format: email
          example: admin@example.com
        phoneNo:
          type: string
          example: "+1234567890"
        password:
          type: string
          format: password
          example: hashed_password_string
        displayName:
          type: string
          nullable: true
          example: John D.
        profileUrl:
          type: string
          nullable: true
          example: https://example.com/profile.jpg
        refreshToken:
          type: string
          nullable: true
          example: null
        isDeleted:
          type: boolean
          example: false
    Report:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 123
        adminId:
          type: integer
          nullable: true
          example: 1
        reportType:
          type: string
          enum:
            - user
            - message
            - review
            - restaurant
            - support
          nullable: true
          example: review
        targetRestaurantId:
          type: integer
          nullable: true
          example: 456
        targetReviewId:
          type: integer
          nullable: true
          example: 789
        targetUserId:
          type: integer
          nullable: true
          example: 321
        targetMessageId:
          type: integer
          nullable: true
          example: null
        isSolved:
          type: boolean
          example: false
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
    Restaurant:
      type: object
      properties:
        id:
          type: integer
          example: 1
        ownerId:
          type: integer
          example: 123
        name:
          type: string
          example: Delicious Thai Restaurant
        phoneNo:
          type: string
          example: "+66812345678"
        wallet:
          type: number
          format: double
          example: 1500.5
        address:
          type: string
          nullable: true
          example: 123 Main Street, Bangkok
        houseNo:
          type: string
          nullable: true
          example: "123"
        village:
          type: string
          nullable: true
          example: Village Name
        building:
          type: string
          nullable: true
          example: Building Name
        road:
          type: string
          nullable: true
          example: Sukhumvit Road
        soi:
          type: string
          nullable: true
          example: Soi 11
        subDistrict:
          type: string
          nullable: true
          example: Khlong Toei Nuea
        district:
          type: string
          nullable: true
          example: Watthana
        province:
          type: string
          nullable: true
          example: Bangkok
        postalCode:
          type: string
          nullable: true
          example: "10110"
        cuisineType:
          type: string
          enum:
            - Thai
            - Chinese
            - Japanese
            - Korean
            - Western
            - Seafood
            - Vegetarian
            - Vegan
            - Halal
            - Bakery
            - Cafe
            - Buffet
            - BBQ
            - Steakhouse
            - Fast Food
            - Indian
            - Italian
            - Other
          example: Thai
        priceRange:
          type: integer
          nullable: true
          example: 300
        paymentMethod:
          type: string
          enum:
            - MasterCard
            - Visa
            - HewkawjangWallet
            - PromptPay
          example: HewkawjangWallet
        status:
          type: string
          enum:
            - open
            - closed
          example: open
        activation:
          type: string
          enum:
            - active
            - inactive
          example: active
        isVerified:
          type: boolean
          example: true
        isDeleted:
          type: boolean
          example: false
        images:
          type: array
          items:
            type: string
          nullable: true
          example:
            - https://example.com/image1.jpg
            - https://example.com/image2.jpg
        reservationFee:
          type: integer
          example: 100
    RestaurantUnverified:
      allOf:
        - $ref: "#/components/schemas/Restaurant"
        - type: object
          properties:
            isVerified:
              type: boolean
              example: false
    ReportReview:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 123
        adminId:
          type: integer
          nullable: true
          example: 1
        reportType:
          type: string
          enum:
            - review
          example: review
        targetRestaurantId:
          type: integer
          nullable: true
          example: 456
        targetReviewId:
          type: integer
          nullable: true
          example: 789
        targetUserId:
          type: integer
          nullable: true
          example: 321
        targetChatId:
          type: integer
          nullable: true
          example: null
        isSolved:
          type: boolean
          example: false
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
        reviewId:
          type: integer
          nullable: true
          example: 789
        reviewRating:
          type: integer
          nullable: true
          minimum: 1
          maximum: 5
          example: 4
        reviewComment:
          type: string
          nullable: true
          example: Great food and service!
        reviewCreatedAt:
          type: string
          format: date-time
          nullable: true
          example: 2024-01-10T14:30:00Z
        reviewImages:
          type: array
          items:
            type: string
          nullable: true
          example:
            - https://example.com/review1.jpg
        reviewAuthorId:
          type: integer
          nullable: true
          example: 456
        reviewAuthorName:
          type: string
          nullable: true
          example: John Doe
        userImage:
          type: string
          nullable: true
          example: https://example.com/profile.jpg
        reviewRestaurant:
          type: string
          nullable: true
          example: Delicious Thai Restaurant
    ReportMessage:
      type: object
      properties:
        id:
          type: integer
          example: 1
        reportType:
          type: string
          enum:
            - message
          example: message
        isSolved:
          type: boolean
          example: false
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
        messageText:
          type: string
          nullable: true
          example: This is an inappropriate message
        messageImageUrl:
          type: string
          nullable: true
          example: https://example.com/message-image.jpg
        reporterName:
          type: string
          nullable: true
          example: John Doe
        reporterImage:
          type: string
          nullable: true
          example: https://example.com/reporter-profile.jpg
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Access token in Authorization header
    cookieAuth:
      type: apiKey
      in: cookie
      name: refreshToken
      description: Refresh token stored in HttpOnly cookie
  parameters:
    AuthClientTypeHeader:
      name: hkj-auth-client-type
      in: header
      required: true
      schema:
        type: string
        enum:
          - web
      description: Client type identifier; must be `"web"` for browser clients
    restaurantId:
      name: restaurantId
      in: path
      required: true
      description: ID of the restaurant
      schema:
        type: integer
    reportId:
      name: reportId
      in: path
      required: true
      description: ID of the report
      schema:
        type: integer
  responses:
    Unauthorized:
      description: Unauthorized - Invalid or missing token (see authHandler)
    AdminAuthUnauthorized:
      description: Unauthorized - Invalid or missing token, or admin role required
        (see authHandler and adminRoleHandler)
    InternalServerError:
      description: Internal Server Error
security:
  - bearerAuth: []
paths:
  /admins/me:
    get:
      summary: Get current admin profile
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved admin profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Admin"
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        "404":
          description: Admin not found
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/reports/pending:
    get:
      summary: Get pending reports for admin review
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved pending reports
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Report"
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/restaurants/pending-verification:
    get:
      summary: Get restaurants pending verification for admin review
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved restaurants that are not verified
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RestaurantUnverified"
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/restaurants/{restaurantId}:
    delete:
      summary: Ban a restaurant by ID
      tags:
        - Admin
      parameters:
        - $ref: "#/components/parameters/restaurantId"
      security:
        - bearerAuth: []
      responses:
        "204":
          description: Restaurant banned successfully
        "400":
          description: Invalid restaurant ID provided
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        "404":
          description: Restaurant not found
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/reports/review:
    get:
      summary: Get reported reviews for admin review
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved reported reviews
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReportReview"
        "400":
          description: Invalid query parameters
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/reports/review/{reportId}/handle:
    post:
      summary: Handle a reported review (ban or reject)
      tags:
        - Admin
      parameters:
        - $ref: "#/components/parameters/reportId"
      security:
        - bearerAuth: []
      requestBody:
        description: Action to take on the reported review
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: boolean
                  description: true to ban the review, false to reject the report
      responses:
        "204":
          description: Successfully handled the reported review
        "400":
          description: Invalid query parameters/body
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        "404":
          description: Report not found
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/restaurants/{restaurantId}/verify:
    post:
      summary: Verify or reject a restaurant's verification status
      tags:
        - Admin
      parameters:
        - $ref: "#/components/parameters/restaurantId"
      security:
        - bearerAuth: []
      requestBody:
        description: Action to take on the restaurant verification
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: boolean
                  description: true to approve, false to reject
      responses:
        "204":
          description: Successfully updated restaurant verification status
        "400":
          description: Invalid query parameters/body
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        "404":
          description: Restaurant not found
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/reports/message/{reportId}/handle:
    post:
      summary: Handle a reported message (delete or reject)
      tags:
        - Admin
      parameters:
        - $ref: "#/components/parameters/reportId"
      security:
        - bearerAuth: []
      requestBody:
        description: Action to take on the reported message
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: boolean
                  description: true to delete the message, false to reject the report
      responses:
        "204":
          description: Successfully handled the reported message
        "400":
          description: Invalid query parameters/body
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        "404":
          description: Report not found
        5XX:
          $ref: "#/components/responses/InternalServerError"
  /admins/reports/message:
    get:
      summary: Get reported messages for admin review
      tags:
        - Admin
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Successfully retrieved reported messages
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReportMessage"
        "400":
          description: Invalid query parameters/body
        "401":
          $ref: "#/components/responses/AdminAuthUnauthorized"
        5XX:
          $ref: "#/components/responses/InternalServerError"
tags: []
